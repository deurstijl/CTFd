import{_ as b,c,o as d,a as t,w as f,v as $,b as H,C as r,d as D,e as L,r as M,n as j,f as T,g as k,h as w,F as v,i as _,t as m,j as G,k as p,l as q,T as O,m as F,p as x,q as S,s as V,$ as g,M as P,u as y,x as C,y as z,z as A,A as R}from"./main-BJW8R6xA.js";import"../tab-BP_E4_QH.js";import{C as J}from"../CommentBox-CsDj8uxd.js";const B={name:"StaticFlagForm",props:{challenge_id:Number,mode:{type:String,default:"create"},initialData:{type:Object,default:()=>({})}},data(){return{flag:this.initialData.content||"",data:this.initialData.data||""}},methods:{submit(){const s={type:"static",content:this.flag,data:this.data};this.challenge_id&&(s.challenge=this.challenge_id),this.mode==="edit"&&(s.id=this.initialData.id),this.$emit("submit",s)}}},K={class:"mb-4"},Y={class:"mb-4"};function Z(s,e,n,a,i,o){return d(),c("div",null,[t("div",K,[e[3]||(e[3]=t("label",{for:"static-flag"},"Flag",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>i.flag=l),type:"text",class:"form-control",id:"static-flag",name:"flag",required:""},null,512),[[$,i.flag]])]),t("div",Y,[e[4]||(e[4]=t("label",{for:"static-data"},"Data (optional)",-1)),f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>i.data=l),type:"text",class:"form-control",id:"static-data",name:"data"},null,512),[[$,i.data]])]),t("button",{class:"btn btn-success float-end",onClick:e[2]||(e[2]=(...l)=>o.submit&&o.submit(...l))}," Create Flag ")])}const I=b(B,[["render",Z]]),Q={name:"RegexFlagForm",props:{challenge_id:{type:Number,default:null},mode:{type:String,default:"create"},initialData:{type:Object,default:()=>({})}},data(){return{flag:this.initialData.content||"",data:this.initialData.data||"true"}},methods:{submit(){const s={type:"regex",content:this.flag,data:this.data};this.challenge_id&&(s.challenge=this.challenge_id),this.mode==="edit"&&this.initialData.id&&(s.id=this.initialData.id),this.$emit("submit",s)}}},W={class:"mb-4"},X={class:"mb-4"};function ee(s,e,n,a,i,o){return d(),c("div",null,[t("div",W,[e[3]||(e[3]=t("label",{for:"regex-flag"},"Regular Expression",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>i.flag=l),type:"text",class:"form-control",id:"regex-flag",name:"flag",placeholder:"e.g. ^CTF\\{[a-zA-Z0-9]+\\}$",required:""},null,512),[[$,i.flag]])]),t("div",X,[e[5]||(e[5]=t("label",{for:"regex-data"},"Case Sensitive",-1)),f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>i.data=l),class:"form-control form-select",id:"regex-data",name:"data"},e[4]||(e[4]=[t("option",{value:"true"},"Yes",-1),t("option",{value:"false"},"No",-1)]),512),[[H,i.data]])]),t("button",{class:"btn btn-success float-end",onClick:e[2]||(e[2]=(...l)=>o.submit&&o.submit(...l))}," Create Flag ")])}const U=b(Q,[["render",ee]]),te={name:"FlagCreationForm",props:{challenge_id:{type:Number,required:!0},visible:{type:Boolean,required:!0}},components:{StaticFlagForm:I,RegexFlagForm:U},data(){return{selectedType:""}},computed:{selectedTypeComponent(){switch(this.selectedType){case"static":return"StaticFlagForm";case"regex":return"RegexFlagForm";default:return null}}},methods:{submitFlag(s){r.fetch("/api/v1/flags",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(e=>e.json()).then(e=>{if(e.success)this.$emit("refreshFlags",this.$options.name),this.$emit("close"),this.selectedType="";else{let n="";for(const a in e.errors)n+=e.errors[a].join(`
`)+`
`;alert(`Error:
`+n)}}).catch(e=>{console.error("Flag creation error:",e),alert("Unexpected error: "+e.message)})}}},se={class:"modal-dialog modal-lg"},ne={class:"modal-content"},le={class:"modal-header text-center"},ie={class:"modal-body"};function oe(s,e,n,a,i,o){return d(),c("div",{id:"flag-create-modal",class:T(["modal fade",{show:n.visible}]),tabindex:"-1",role:"dialog","aria-modal":"true",style:j({display:n.visible?"block":"none"})},[t("div",se,[t("div",ne,[t("div",le,[e[3]||(e[3]=t("div",{class:"container"},[t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("h3",null,"Create Flag")])])],-1)),t("button",{type:"button",class:"close",onClick:e[0]||(e[0]=l=>s.$emit("close")),"aria-label":"Close"},e[2]||(e[2]=[t("span",{"aria-hidden":"true"},"×",-1)]))]),t("div",ie,[e[5]||(e[5]=t("label",{for:"create-keys-select",class:"control-label"}," Choose Flag Type ",-1)),f(t("select",{class:"form-control form-select","onUpdate:modelValue":e[1]||(e[1]=l=>i.selectedType=l)},e[4]||(e[4]=[t("option",{disabled:"",value:""},"--",-1),t("option",{value:"static"},"static",-1),t("option",{value:"regex"},"regex",-1)]),512),[[H,i.selectedType]]),e[6]||(e[6]=t("br",null,null,-1)),o.selectedTypeComponent?(d(),D(M(o.selectedTypeComponent),{key:0,challenge_id:n.challenge_id,onSubmit:o.submitFlag},null,40,["challenge_id","onSubmit"])):L("",!0)])])])],6)}const ae=b(te,[["render",oe],["__scopeId","data-v-47ba21a7"]]),re={name:"FlagEditForm",props:{flag_id:Number,visible:Boolean},components:{StaticFlagForm:I,RegexFlagForm:U},data(){return{flag:null}},computed:{selectedTypeComponent(){if(!this.flag)return null;switch(this.flag.type){case"static":return"StaticFlagForm";case"regex":return"RegexFlagForm";default:return null}}},watch:{visible(s){s&&this.flag_id!=null&&this.loadFlag()}},methods:{loadFlag(){r.fetch(`/api/v1/flags/${this.flag_id}`,{method:"GET"}).then(s=>s.json()).then(s=>{this.flag=s.data}).catch(s=>{console.error("Failed to load flag:",s)})},updateFlag(s){r.fetch(`/api/v1/flags/${this.flag_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(e=>e.json()).then(e=>{if(e.success)this.$emit("refreshFlags",this.$options.name),this.$emit("close"),this.flag=null;else{let n="";for(const a in e.errors)n+=e.errors[a].join(`
`)+`
`;alert(`Error updating flag:
`+n)}}).catch(e=>{console.error("Error updating flag:",e),alert("Unexpected error: "+e.message)})}}},de={class:"modal-dialog modal-lg"},ce={class:"modal-content"},ue={class:"modal-header text-center"},he={class:"modal-body"};function me(s,e,n,a,i,o){return d(),c("div",{id:"flag-edit-modal",class:T(["modal fade",{show:n.visible}]),tabindex:"-1",role:"dialog","aria-modal":"true",style:j({display:n.visible?"block":"none"})},[t("div",de,[t("div",ce,[t("div",ue,[e[2]||(e[2]=t("div",{class:"container"},[t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("h3",null,"Edit Flag")])])],-1)),t("button",{type:"button",class:"close",onClick:e[0]||(e[0]=l=>s.$emit("close")),"aria-label":"Close"},e[1]||(e[1]=[t("span",{"aria-hidden":"true"},"×",-1)]))]),t("div",he,[i.flag&&o.selectedTypeComponent?(d(),D(M(o.selectedTypeComponent),{key:0,mode:"edit",initialData:i.flag,onSubmit:o.updateFlag},null,40,["initialData","onSubmit"])):L("",!0)])])])],6)}const pe=b(re,[["render",me],["__scopeId","data-v-c9735749"]]),fe={components:{FlagCreationForm:ae,FlagEditForm:pe},props:{challenge_id:{type:Number,required:!0}},data(){return{flags:[],editing_flag_id:null,showCreateModal:!1,showEditModal:!1}},methods:{async loadFlags(){try{const e=await(await r.fetch(`/api/v1/challenges/${this.challenge_id}/flags`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}})).json();e.success&&(this.flags=e.data)}catch(s){console.error("Failed to load flags:",s)}},refreshFlags(){this.loadFlags(),this.showCreateModal=!1,this.showEditModal=!1},addFlag(){this.showCreateModal=!0},editFlag(s){this.editing_flag_id=s,this.showEditModal=!0},closeEditModal(){this.editing_flag_id=null,this.showEditModal=!1},async deleteFlag(s){if(confirm("Are you sure you'd like to delete this flag?"))try{(await(await r.fetch(`/api/v1/flags/${s}`,{method:"DELETE"})).json()).success?this.loadFlags():alert("Failed to delete flag.")}catch(e){console.error("Delete failed:",e)}}},created(){this.loadFlags()}},ge={id:"flagsboard",class:"table table-striped"},be={class:"text-center"},ve={class:"text-break"},_e={class:"flag-content"},ye={class:"text-center"},Ce=["onClick"],$e=["onClick"],we={class:"col-md-12"};function Te(s,e,n,a,i,o){const l=k("FlagCreationForm"),u=k("FlagEditForm");return d(),c("div",null,[w(l,{challenge_id:n.challenge_id,visible:i.showCreateModal,onRefreshFlags:o.refreshFlags,onClose:e[0]||(e[0]=h=>i.showCreateModal=!1)},null,8,["challenge_id","visible","onRefreshFlags"]),w(u,{flag_id:i.editing_flag_id,visible:i.showEditModal,onRefreshFlags:o.refreshFlags,onClose:o.closeEditModal},null,8,["flag_id","visible","onRefreshFlags","onClose"]),t("table",ge,[e[2]||(e[2]=t("thead",null,[t("tr",null,[t("td",{class:"text-center"},[t("b",null,"Type")]),t("td",{class:"text-center"},[t("b",null,"Flag")]),t("td",{class:"text-center"},[t("b",null,"Settings")])])],-1)),t("tbody",null,[(d(!0),c(v,null,_(i.flags,h=>(d(),c("tr",{key:h.id},[t("td",be,m(h.type),1),t("td",ve,[t("pre",_e,m(h.content),1)]),t("td",ye,[t("i",{role:"button",class:"btn-fa fas fa-edit edit-flag",onClick:E=>o.editFlag(h.id)},null,8,Ce),t("i",{role:"button",class:"btn-fa fas fa-times delete-flag",onClick:E=>o.deleteFlag(h.id)},null,8,$e)])]))),128))])]),t("div",we,[t("button",{id:"flag-add-button",class:"btn btn-success d-inline-block float-end",onClick:e[1]||(e[1]=(...h)=>o.addFlag&&o.addFlag(...h))}," Create Flag ")])])}const Fe=b(fe,[["render",Te]]),Ee={props:{challenge_id:Number},data:function(){return{challenges:[],requirements:{},selectedRequirements:[],selectedAnonymize:!1}},computed:{newRequirements:function(){let s=this.requirements.prerequisites||[],e=this.requirements.anonymize||!1,n=JSON.stringify(s.sort())!==JSON.stringify(this.selectedRequirements.sort()),a=e!==this.selectedAnonymize;return n||a},requiredChallenges:function(){const s=this.requirements.prerequisites||[];return this.challenges.filter(e=>e.id!==this.$props.challenge_id&&s.includes(e.id))},otherChallenges:function(){const s=this.requirements.prerequisites||[];return this.challenges.filter(e=>e.id!==this.$props.challenge_id&&!s.includes(e.id))}},methods:{loadChallenges:function(){r.fetch("/api/v1/challenges?view=admin",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{s.success&&(this.challenges=s.data)})},getChallengeNameById:function(s){let e=this.challenges.find(n=>n.id===s);return e?e.name:""},loadRequirements:function(){r.fetch(`/api/v1/challenges/${this.$props.challenge_id}/requirements`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{s.success&&(this.requirements=s.data||{},this.selectedRequirements=this.requirements.prerequisites||[],this.selectedAnonymize=this.requirements.anonymize||!1)})},updateRequirements:function(){const e={requirements:{prerequisites:this.selectedRequirements}};this.selectedAnonymize&&(e.requirements.anonymize=!0),r.fetch(`/api/v1/challenges/${this.$props.challenge_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(n=>n.json()).then(n=>{n.success&&this.loadRequirements()})}},created(){this.loadChallenges(),this.loadRequirements()}},xe={class:"mb-4 scrollbox"},ke={class:"form-check-label cursor-pointer"},qe=["value"],He={class:"form-check-label cursor-pointer"},je=["value"],Se={class:"mb-4"},Ae={class:"mb-4"},Re=["disabled"];function Ne(s,e,n,a,i,o){return d(),c("div",null,[t("form",{onSubmit:e[3]||(e[3]=F((...l)=>o.updateRequirements&&o.updateRequirements(...l),["prevent"]))},[t("div",xe,[w(O,{name:"flip-list"},{default:G(()=>[(d(!0),c(v,null,_(o.requiredChallenges,l=>(d(),c("div",{class:"form-check",key:l.id},[t("label",ke,[f(t("input",{class:"form-check-input",type:"checkbox",value:l.id,"onUpdate:modelValue":e[0]||(e[0]=u=>s.selectedRequirements=u)},null,8,qe),[[q,s.selectedRequirements]]),p(" "+m(l.name),1)])]))),128)),(d(!0),c(v,null,_(o.otherChallenges,l=>(d(),c("div",{class:"form-check",key:l.id},[t("label",He,[f(t("input",{class:"form-check-input",type:"checkbox",value:l.id,"onUpdate:modelValue":e[1]||(e[1]=u=>s.selectedRequirements=u)},null,8,je),[[q,s.selectedRequirements]]),p(" "+m(l.name),1)])]))),128))]),_:1})]),t("div",Se,[e[5]||(e[5]=t("label",null,[t("b",null,"Behavior if not unlocked")],-1)),f(t("select",{class:"form-control form-select",name:"anonymize","onUpdate:modelValue":e[2]||(e[2]=l=>s.selectedAnonymize=l)},e[4]||(e[4]=[t("option",{value:!1},"Hidden",-1),t("option",{value:!0},"Anonymized",-1)]),512),[[H,s.selectedAnonymize]])]),t("div",Ae,[t("button",{class:"btn btn-success float-end",disabled:!o.newRequirements}," Save ",8,Re)])],32)])}const De=b(Ee,[["render",Ne],["__scopeId","data-v-2d6cb3e7"]]),Le={props:{challenge_id:Number},data:function(){return{topics:[],topicValue:"",searchedTopic:"",topicResults:[],selectedResultIdx:0,awaitingSearch:!1}},methods:{loadTopics:function(){r.fetch(`/api/v1/challenges/${this.$props.challenge_id}/topics`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{s.success&&(this.topics=s.data)})},searchTopics:function(){if(this.selectedResultIdx=0,this.topicValue==""){this.topicResults=[];return}r.fetch(`/api/v1/topics?field=value&q=${this.topicValue}`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{s.success&&(this.topicResults=s.data.slice(0,10))})},addTopic:function(){let s;if(this.selectedResultIdx===0)s=this.topicValue;else{let n=this.selectedResultIdx-1;s=this.topicResults[n].value}const e={value:s,challenge:this.$props.challenge_id,type:"challenge"};r.fetch("/api/v1/topics",{method:"POST",body:JSON.stringify(e)}).then(n=>n.json()).then(n=>{n.success&&(this.topicValue="",this.loadTopics())})},deleteTopic:function(s){r.fetch(`/api/v1/topics?type=challenge&target_id=${s}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{e.success&&this.loadTopics()})},moveCursor:function(s){switch(s){case"up":this.selectedResultIdx&&(this.selectedResultIdx-=1);break;case"down":this.selectedResultIdx<this.topicResults.length&&(this.selectedResultIdx+=1);break}},selectTopic:function(s){s===void 0&&(s=this.selectedResultIdx);let e=this.topicResults[s];this.topicValue=e.value}},watch:{topicValue:function(s){this.awaitingSearch===!1&&setTimeout(()=>{this.searchTopics(),this.awaitingSearch=!1},500),this.awaitingSearch=!0}},created(){this.loadTopics()}},Me={class:"col-md-12"},Ve={id:"challenge-topics",class:"my-3"},Ie={class:"mr-1"},Ue=["onClick"],Ge={class:"mb-4"},Oe={class:"mb-4"},Pe={class:"list-group"},ze=["onClick"];function Je(s,e,n,a,i,o){return d(),c("div",Me,[t("div",Ve,[(d(!0),c(v,null,_(s.topics,l=>(d(),c("h5",{class:"challenge-tag",key:l.id},[t("span",Ie,m(l.value),1),t("a",{class:"btn-fa delete-tag",onClick:u=>o.deleteTopic(l.id)}," ×",8,Ue)]))),128))]),t("div",Ge,[e[4]||(e[4]=t("label",null,[p(" Topic "),t("br"),t("small",{class:"text-muted"},"Type topic and press Enter")],-1)),f(t("input",{id:"tags-add-input",maxlength:"255",type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=l=>s.topicValue=l),onKeyup:[e[1]||(e[1]=x(l=>o.moveCursor("down"),["down"])),e[2]||(e[2]=x(l=>o.moveCursor("up"),["up"])),e[3]||(e[3]=x(l=>o.addTopic(),["enter"]))]},null,544),[[$,s.topicValue]])]),t("div",Oe,[t("ul",Pe,[(d(!0),c(v,null,_(s.topicResults,(l,u)=>(d(),c("li",{class:T({"list-group-item":!0,active:u+1===s.selectedResultIdx}),key:l.id,onClick:h=>o.selectTopic(u)},m(l.value),11,ze))),128))])])])}const Be=b(Le,[["render",Je]]),Ke={props:{challenge_id:Number},data:function(){return{tags:[],tagValue:""}},methods:{loadTags:function(){r.fetch(`/api/v1/challenges/${this.$props.challenge_id}/tags`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{s.success&&(this.tags=s.data)})},addTag:function(){if(this.tagValue){const s={value:this.tagValue,challenge:this.$props.challenge_id};r.api.post_tag_list({},s).then(e=>{e.success&&(this.tagValue="",this.loadTags())})}},deleteTag:function(s){r.api.delete_tag({tagId:s}).then(e=>{e.success&&this.loadTags()})}},created(){this.loadTags()}},Ye={class:"col-md-12"},Ze={id:"challenge-tags",class:"my-3"},Qe=["onClick"],We={class:"mb-4"};function Xe(s,e,n,a,i,o){return d(),c("div",Ye,[t("div",Ze,[(d(!0),c(v,null,_(s.tags,l=>(d(),c("span",{class:"badge bg-primary mx-1 challenge-tag",key:l.id},[t("span",null,m(l.value),1),t("a",{class:"btn-fa delete-tag text-white",onClick:u=>o.deleteTag(l.id)}," ×",8,Qe)]))),128))]),t("div",We,[e[2]||(e[2]=t("label",null,[p("Tag "),t("br"),t("small",{class:"text-muted"},"Type tag and press Enter")],-1)),f(t("input",{id:"tags-add-input",maxlength:"80",type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=l=>s.tagValue=l),onKeyup:e[1]||(e[1]=x(l=>o.addTag(),["enter"]))},null,544),[[$,s.tagValue]])])])}const et=b(Ke,[["render",Xe]]),tt={props:{challenge_id:Number},data:function(){return{files:[],urlRoot:r.config.urlRoot}},methods:{loadFiles:function(){r.fetch(`/api/v1/challenges/${this.$props.challenge_id}/files`,{method:"GET"}).then(s=>s.json()).then(s=>{s.success&&(this.files=s.data)})},addFiles:async function(){const e=this.$refs.FileUploadForm.querySelector("#file");if(!e.files.length){alert("Please select at least one file.");return}const n=new FormData;for(let a=0;a<e.files.length;a++)n.append("file",e.files[a]);n.append("type","challenge"),n.append("challenge",this.challenge_id),n.append("nonce",r.config.csrfNonce);try{const i=await(await fetch(`${r.config.urlRoot}/api/v1/files`,{method:"POST",credentials:"same-origin",body:n})).json();if(i.success)this.loadFiles();else{let o="";for(const l in i.errors)o+=i.errors[l].join(`
`)+`
`;alert(`Upload failed:
`+o)}}catch(a){console.error("File upload error:",a),alert("Unexpected error: "+a.message)}},deleteFile(s){confirm("Are you sure you want to delete this file?")&&r.fetch(`/api/v1/files/${s}`,{method:"DELETE",credentials:"same-origin"}).then(n=>n.json()).then(n=>{n.success?this.loadFiles():alert("Failed to delete the file.")}).catch(n=>{console.error("Error deleting file:",n),alert("Unexpected error: "+n.message)})}},created(){this.loadFiles()}},st={id:"filesboard",class:"table table-striped"},nt={class:"text-start"},lt=["href"],it={class:"d-flex flex-row align-items-center"},ot={class:"d-inline-block mr-2 small text-muted"},at={class:"text-center"},rt=["onClick"],dt={class:"col-md-12 mt-3"};function ct(s,e,n,a,i,o){return d(),c("div",null,[t("table",st,[e[2]||(e[2]=t("thead",null,[t("tr",null,[t("td",{class:"text-center"},[t("b",null,"File")]),t("td",{class:"text-center"},[t("b",null,"Settings")])])],-1)),t("tbody",null,[(d(!0),c(v,null,_(s.files,l=>(d(),c("tr",{key:l.id},[t("td",nt,[t("a",{href:`${s.urlRoot}/files/${l.location}`},m(l.location.split("/").pop()),9,lt),t("div",it,[e[1]||(e[1]=t("strong",{class:"mr-2 small"}," SHA1: ",-1)),t("span",ot,m(l.sha1sum||"null"),1)])]),t("td",at,[t("i",{role:"button",class:"btn-fa fas fa-times delete-file",onClick:u=>o.deleteFile(l.id)},null,8,rt)])]))),128))])]),t("div",dt,[t("form",{method:"POST",ref:"FileUploadForm",onSubmit:e[0]||(e[0]=F((...l)=>o.addFiles&&o.addFiles(...l),["prevent"]))},e[3]||(e[3]=[S('<div class="mb-4"><input class="form-control" id="file" multiple="" name="file" required="" type="file"><sub class="text-muted"> Attach multiple files using Control+Click or Cmd+Click. </sub></div><div class="mb-4"><input class="btn btn-success float-end" id="_submit" name="_submit" type="submit" value="Upload"></div>',2)]),544)])])}const ut=b(tt,[["render",ct]]),ht={name:"HintCreationForm",props:{challenge_id:Number,hints:Array,visible:Boolean},data(){return{cost:0,selectedHints:[]}},methods:{getCost(){return this.cost||0},getContent(){return this.$refs.content.value},getTitle(){return this.$refs.title.value},submitHint(){const s={challenge_id:this.challenge_id,content:this.getContent(),cost:this.getCost(),title:this.getTitle(),requirements:{prerequisites:this.selectedHints}};r.fetch("/api/v1/hints",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(e=>e.json()).then(e=>{e.success?(this.$emit("refreshHints",this.$options.name),this.$emit("close"),this.resetForm()):alert("Error creating hint.")}).catch(e=>{console.error("Creation failed:",e),alert("Unexpected error: "+e.message)})},resetForm(){this.cost=0,this.selectedHints=[],this.$refs.title&&(this.$refs.title.value=""),this.$refs.content&&(this.$refs.content.value="")}},watch:{visible(s){s&&(this.$nextTick(()=>V(this.$refs.content)),this.resetForm())}}},mt={class:"modal-dialog"},pt={class:"modal-content"},ft={class:"modal-header text-center"},gt={class:"modal-body"},bt={class:"container"},vt={class:"row"},_t={class:"col-md-12"},yt={class:"mb-4"},Ct={type:"text",class:"form-control",name:"title",ref:"title"},$t={class:"mb-4"},wt={type:"text",class:"form-control",name:"content",rows:"7",ref:"content"},Tt={class:"mb-4"},Ft={class:"mb-4"},Et={class:"form-check-label cursor-pointer"},xt=["value"];function kt(s,e,n,a,i,o){return d(),c("div",{class:T(["modal fade",{show:n.visible}]),tabindex:"-1",role:"dialog","aria-modal":"true",style:j({display:n.visible?"block":"none"})},[t("div",mt,[t("div",pt,[t("div",ft,[e[5]||(e[5]=t("div",{class:"container"},[t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("h3",null,"Create Hint")])])],-1)),t("button",{type:"button",class:"close",onClick:e[0]||(e[0]=l=>s.$emit("close")),"aria-label":"Close"},e[4]||(e[4]=[t("span",{"aria-hidden":"true"},"×",-1)]))]),t("form",{method:"POST",onSubmit:e[3]||(e[3]=F((...l)=>o.submitHint&&o.submitHint(...l),["prevent"]))},[t("div",gt,[t("div",bt,[t("div",vt,[t("div",_t,[t("div",yt,[e[6]||(e[6]=t("label",null,[p(" Title"),t("br"),t("small",null,"Content shown before unlocking")],-1)),t("input",Ct,null,512)]),t("div",$t,[e[7]||(e[7]=t("label",null,[p(" Hint"),t("br"),t("small",null,"Markdown & HTML supported")],-1)),t("textarea",wt,null,512)]),t("div",Tt,[e[8]||(e[8]=t("label",null,[p(" Cost"),t("br"),t("small",null,"Points required to view")],-1)),f(t("input",{type:"number",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=l=>i.cost=l)},null,512),[[$,i.cost,void 0,{lazy:!0}]])]),t("div",Ft,[e[9]||(e[9]=t("label",null,[p(" Requirements"),t("br"),t("small",null,"Hints that must be unlocked before this one")],-1)),(d(!0),c(v,null,_(n.hints,l=>(d(),c("div",{class:"form-check",key:l.id},[t("label",Et,[f(t("input",{class:"form-check-input",type:"checkbox",value:l.id,"onUpdate:modelValue":e[2]||(e[2]=u=>i.selectedHints=u)},null,8,xt),[[q,i.selectedHints]]),p(" "+m(l.cost)+" - "+m(l.id),1)])]))),128))])])])])]),e[10]||(e[10]=S('<div class="modal-footer" data-v-89fd4506><div class="container" data-v-89fd4506><div class="row" data-v-89fd4506><div class="col-md-12" data-v-89fd4506><button class="btn btn-primary float-end" data-v-89fd4506>Submit</button></div></div></div></div>',1))],32)])])],6)}const qt=b(ht,[["render",kt],["__scopeId","data-v-89fd4506"]]),Ht={name:"HintEditForm",props:{challenge_id:Number,hint_id:Number,hints:Array,visible:Boolean},data(){return{cost:0,title:null,content:null,selectedHints:[]}},computed:{otherHints(){return this.hints.filter(s=>s.id!==this.hint_id)}},watch:{hint_id:{immediate:!0,handler(s){s!==null&&this.loadHint()}},visible(s){s&&this.hint_id!=null&&this.loadHint()}},methods:{loadHint(){r.fetch(`/api/v1/hints/${this.hint_id}?preview=true`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{var e;if(s.success){const n=s.data;this.cost=n.cost,this.title=n.title,this.content=n.content,this.selectedHints=((e=n.requirements)==null?void 0:e.prerequisites)||[],this.$nextTick(()=>{const a=this.$refs.content;V(a),setTimeout(()=>{a.mde.codemirror.getDoc().setValue(this.content||""),a.mde.codemirror.refresh()},200)})}})},updateHint(){const s={challenge_id:this.challenge_id,content:this.getContent(),cost:this.cost||0,title:this.getTitle(),requirements:{prerequisites:this.selectedHints}};r.fetch(`/api/v1/hints/${this.hint_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(e=>e.json()).then(e=>{e.success?(this.$emit("refreshHints",this.$options.name),this.$emit("close")):alert("Failed to update hint.")}).catch(e=>{console.error("Update failed:",e),alert("Unexpected error: "+e.message)})},getContent(){return this.$refs.content.mde.codemirror.getDoc().getValue()},getTitle(){return this.$refs.title.value}}},jt={class:"modal-dialog"},St={class:"modal-content"},At={class:"modal-header text-center"},Rt={class:"modal-body"},Nt={class:"container"},Dt={class:"row"},Lt={class:"col-md-12"},Mt={class:"mb-4"},Vt=["value"],It={class:"mb-4"},Ut=["value"],Gt={class:"mb-4"},Ot={class:"mb-4"},Pt={class:"form-check-label"},zt=["value"];function Jt(s,e,n,a,i,o){return d(),c("div",{class:T(["modal fade",{show:n.visible}]),tabindex:"-1",role:"dialog","aria-modal":"true",style:j({display:n.visible?"block":"none"})},[t("div",jt,[t("div",St,[t("div",At,[e[5]||(e[5]=t("div",{class:"container"},[t("div",{class:"row"},[t("div",{class:"col-md-12"},[t("h3",null,"Edit Hint")])])],-1)),t("button",{type:"button",class:"close",onClick:e[0]||(e[0]=l=>s.$emit("close")),"aria-label":"Close"},e[4]||(e[4]=[t("span",{"aria-hidden":"true"},"×",-1)]))]),t("form",{method:"POST",onSubmit:e[3]||(e[3]=F((...l)=>o.updateHint&&o.updateHint(...l),["prevent"]))},[t("div",Rt,[t("div",Nt,[t("div",Dt,[t("div",Lt,[t("div",Mt,[e[6]||(e[6]=t("label",null,[p("Title"),t("br"),t("small",null,"Shown before unlocking")],-1)),t("input",{type:"text",class:"form-control",name:"title",value:i.title,ref:"title"},null,8,Vt)]),t("div",It,[e[7]||(e[7]=t("label",null,[p("Hint"),t("br"),t("small",null,"Markdown & HTML supported")],-1)),t("textarea",{class:"form-control",name:"content",rows:"7",value:i.content,ref:"content"},null,8,Ut)]),t("div",Gt,[e[8]||(e[8]=t("label",null,[p("Cost"),t("br"),t("small",null,"Points required to view")],-1)),f(t("input",{type:"number",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=l=>i.cost=l)},null,512),[[$,i.cost,void 0,{lazy:!0}]])]),t("div",Ot,[e[9]||(e[9]=t("label",null,[p("Requirements"),t("br"),t("small",null,"Hints that must be unlocked first")],-1)),(d(!0),c(v,null,_(o.otherHints,l=>(d(),c("div",{class:"form-check",key:l.id},[t("label",Pt,[f(t("input",{class:"form-check-input",type:"checkbox",value:l.id,"onUpdate:modelValue":e[2]||(e[2]=u=>i.selectedHints=u)},null,8,zt),[[q,i.selectedHints]]),p(" "+m(l.content)+" - "+m(l.cost),1)])]))),128))])])])])]),e[10]||(e[10]=S('<div class="modal-footer" data-v-d161a006><div class="container" data-v-d161a006><div class="row" data-v-d161a006><div class="col-md-12" data-v-d161a006><button class="btn btn-primary float-end" data-v-d161a006>Submit</button></div></div></div></div>',1))],32)])])],6)}const Bt=b(Ht,[["render",Jt],["__scopeId","data-v-d161a006"]]),Kt={components:{HintCreationForm:qt,HintEditForm:Bt},props:{challenge_id:Number},data(){return{hints:[],editing_hint_id:null,showCreateModal:!1,showEditModal:!1}},methods:{async loadHints(){const e=await(await r.fetch(`/api/v1/challenges/${this.challenge_id}/hints`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}})).json();return e.success?(this.hints=e.data,!0):!1},addHint(){this.showCreateModal=!0},editHint(s){this.editing_hint_id=s,this.showEditModal=!0},closeEditModal(){this.editing_hint_id=null,this.showEditModal=!1},async refreshHints(s){await this.loadHints()||alert("An error occurred while updating this hint. Please try again."),s==="HintCreationForm"?this.showCreateModal=!1:s==="HintEditForm"&&this.closeEditModal()},deleteHint(s){confirm("Are you sure you want to delete this hint?")&&r.fetch(`/api/v1/hints/${s}`,{method:"DELETE",credentials:"same-origin"}).then(e=>e.json()).then(e=>{e.success?this.loadHints():alert("Failed to delete the hint.")}).catch(e=>{console.error("Hint deletion failed:",e),alert("Unexpected error: "+e.message)})}},created(){this.loadHints()}},Yt={class:"table table-striped"},Zt={class:"text-center"},Qt={class:"text-center"},Wt={class:"text-break"},Xt={class:"text-center"},es={class:"text-center"},ts=["onClick"],ss=["onClick"],ns={class:"col-md-12"};function ls(s,e,n,a,i,o){const l=k("HintCreationForm"),u=k("HintEditForm");return d(),c("div",null,[w(l,{challenge_id:n.challenge_id,visible:i.showCreateModal,hints:i.hints,onRefreshHints:o.refreshHints,onClose:e[0]||(e[0]=h=>i.showCreateModal=!1)},null,8,["challenge_id","visible","hints","onRefreshHints"]),w(u,{challenge_id:n.challenge_id,hint_id:i.editing_hint_id,visible:i.showEditModal,hints:i.hints,onRefreshHints:o.refreshHints,onClose:o.closeEditModal},null,8,["challenge_id","hint_id","visible","hints","onRefreshHints","onClose"]),t("table",Yt,[e[2]||(e[2]=t("thead",null,[t("tr",null,[t("td",{class:"text-center"},[t("b",null,"ID")]),t("td",{class:"text-center"},[t("b",null,"Title")]),t("td",{class:"text-center"},[t("b",null,"Hint")]),t("td",{class:"text-center"},[t("b",null,"Cost")]),t("td",{class:"text-center"},[t("b",null,"Settings")])])],-1)),t("tbody",null,[(d(!0),c(v,null,_(i.hints,h=>(d(),c("tr",{key:h.id},[t("td",Zt,m(h.type),1),t("td",Qt,m(h.title),1),t("td",Wt,[t("pre",null,m(h.content),1)]),t("td",Xt,m(h.cost),1),t("td",es,[t("i",{role:"button",class:"btn-fa fas fa-edit",onClick:E=>o.editHint(h.id)},null,8,ts),t("i",{role:"button",class:"btn-fa fas fa-times",onClick:E=>o.deleteHint(h.id)},null,8,ss)])]))),128))])]),t("div",ns,[t("button",{class:"btn btn-success float-end",onClick:e[1]||(e[1]=(...h)=>o.addHint&&o.addHint(...h))}," Create Hint ")])])}const is=b(Kt,[["render",ls]]),os={props:{challenge_id:Number},data:function(){return{challenge:null,challenges:[],selected_id:null}},computed:{updateAvailable:function(){return this.challenge?this.selected_id!=this.challenge.next_id:!1},otherChallenges:function(){return this.challenges.filter(s=>s.id!==this.$props.challenge_id)}},methods:{loadData:function(){r.fetch(`/api/v1/challenges/${this.$props.challenge_id}`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{s.success&&(this.challenge=s.data,this.selected_id=s.data.next_id)})},loadChallenges:function(){r.fetch("/api/v1/challenges?view=admin",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{s.success&&(this.challenges=s.data)})},updateNext:function(){r.fetch(`/api/v1/challenges/${this.$props.challenge_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({next_id:this.selected_id!="null"?this.selected_id:null})}).then(s=>s.json()).then(s=>{s.success&&(this.loadData(),this.loadChallenges())})}},created(){this.loadData(),this.loadChallenges()}},as={class:"mb-4"},rs=["value"],ds={class:"mb-4"},cs=["disabled"];function us(s,e,n,a,i,o){return d(),c("div",null,[t("form",{onSubmit:e[1]||(e[1]=F((...l)=>o.updateNext&&o.updateNext(...l),["prevent"]))},[t("div",as,[e[3]||(e[3]=t("label",null,[p(" Next Challenge "),t("br"),t("small",{class:"text-muted"},"Challenge to recommend after solving this challenge")],-1)),f(t("select",{class:"form-control form-select","onUpdate:modelValue":e[0]||(e[0]=l=>s.selected_id=l)},[e[2]||(e[2]=t("option",{value:"null"},"--",-1)),(d(!0),c(v,null,_(o.otherChallenges,l=>(d(),c("option",{value:l.id,key:l.id},m(l.name),9,rs))),128))],512),[[H,s.selected_id]])]),t("div",ds,[t("button",{class:"btn btn-success float-end",disabled:!o.updateAvailable}," Save ",8,cs)])],32)])}const hs=b(os,[["render",us]]);function N(s){r._internal.challenge={},A(r.config.urlRoot+s.scripts.view).then(()=>{const e=s.create,n=document.querySelector("#create-chal-entry-div");if(!n)throw new Error("create-chal-entry-div not found");return console.log("FRANKDEBUG create-chal-entry-div  found"),n.innerHTML=e,typeof R=="function"&&R(),A(r.config.urlRoot+s.scripts.create)}).then(()=>{const e=document.querySelector("#create-chal-entry-div form");if(!e)throw new Error("Challenge form not found");e.addEventListener("submit",async n=>{n.preventDefault();const a=new FormData(e),i=Object.fromEntries(a.entries());try{const l=await(await r.fetch("/api/v1/challenges",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)})).json();if(l.success){const u=document.querySelector("#challenge-create-options #challenge_id");u&&(u.value=l.data.id);const h=document.querySelector("#challenge-create-options");h&&typeof bootstrap<"u"&&new bootstrap.Modal(h).show()}else{let u="";for(const h in l.errors)u+=l.errors[h].join(`
`)+`
`;alert(u)}}catch(o){console.error("Challenge creation failed:",o),alert(o.message)}})}).catch(e=>{console.error("Error in loadChalTemplate:",e)})}function ms(s){s.preventDefault();var e=g(s.target).serializeJSON(!0);let n={challenge_id:e.challenge_id,content:e.flag||"",type:e.flag_type,data:e.flag_data?e.flag_data:""},a=function(){r.fetch("/api/v1/challenges/"+e.challenge_id,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({state:e.state})}).then(function(i){return i.json()}).then(function(i){i.success&&setTimeout(function(){window.location=r.config.urlRoot+"/admin/challenges/"+e.challenge_id},700)})};Promise.all([new Promise(function(i,o){if(n.content.length==0){i();return}r.fetch("/api/v1/flags",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(l){i(l.json())})}),new Promise(function(i,o){let l=s.target,u={challenge:e.challenge_id,type:"challenge"};g(l.elements.file).val()&&z.files.upload(l,u),i()})]).then(i=>{a()})}g(()=>{var s,e;if(g(".preview-challenge").click(function(n){let a=`${r.config.urlRoot}/admin/challenges/preview/${window.CHALLENGE_ID}`;g("#challenge-window").html(`<iframe src="${a}" height="100%" width="100%" frameBorder=0></iframe>`),g("#challenge-modal").modal()}),(s=document.querySelector(".comments-challenge"))==null||s.addEventListener("click",()=>{const n=document.getElementById("challenge-comments-window");n&&(document.querySelector("#comment-box"),new P(n).show())}),(e=document.querySelector(".delete-challenge"))==null||e.addEventListener("click",function(){const n=window.CHALLENGE_NAME||"this challenge";confirm(`Are you sure you want to delete "${n}"?`)&&r.fetch(`/api/v1/challenges/${window.CHALLENGE_ID}`,{method:"DELETE"}).then(i=>i.json()).then(i=>{i.success?window.location=`${r.config.urlRoot}/admin/challenges`:alert("Failed to delete the challenge.")}).catch(i=>{console.error("Delete failed:",i),alert("Unexpected error: "+i.message)})}),g("#challenge-update-container > form").submit(function(n){n.preventDefault();var a=g(n.target).serializeJSON(!0);r.fetch("/api/v1/challenges/"+window.CHALLENGE_ID+"/flags",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(i){return i.json()}).then(function(i){let o=function(){r.fetch("/api/v1/challenges/"+window.CHALLENGE_ID,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(l){return l.json()}).then(function(l){if(l.success){switch(g(".challenge-state").text(l.data.state),l.data.state){case"visible":g(".challenge-state").removeClass("badge-danger").addClass("badge-success");break;case"hidden":g(".challenge-state").removeClass("badge-success").addClass("badge-danger");break}alert("Your challenge has been updated!")}else{let u="";for(const h in l.errors)u+=l.errors[h].join(`
`),u+=`
`;alert(u)}})};i.data.length===0&&a.state==="visible"?confirm("This challenge does not have any flags meaning it may be unsolveable. Are you sure you'd like to update this challenge?")&&o():o()})}),g("#challenge-create-options form").submit(ms),document.querySelector("#challenge-flags")){let n=document.createElement("div");document.querySelector("#challenge-flags").appendChild(n),y({render:()=>C(Fe,{challenge_id:window.CHALLENGE_ID})}).mount(n)}if(document.querySelector("#challenge-topics")){let n=document.createElement("div");document.querySelector("#challenge-topics").appendChild(n),y({render:()=>C(Be,{challenge_id:window.CHALLENGE_ID})}).mount(n)}if(document.querySelector("#challenge-tags")){let n=document.createElement("div");document.querySelector("#challenge-tags").appendChild(n),y({render:()=>C(et,{challenge_id:window.CHALLENGE_ID})}).mount(n)}if(document.querySelector("#prerequisite-add-form")){let n=document.createElement("div");document.querySelector("#prerequisite-add-form").appendChild(n),y({render:()=>C(De,{challenge_id:window.CHALLENGE_ID})}).mount(n)}if(document.querySelector("#challenge-files")){let n=document.createElement("div");document.querySelector("#challenge-files").appendChild(n),y({render:()=>C(ut,{challenge_id:window.CHALLENGE_ID})}).mount(n)}if(document.querySelector("#challenge-hints")){let n=document.createElement("div");document.querySelector("#challenge-hints").appendChild(n),y({render:()=>C(is,{challenge_id:window.CHALLENGE_ID})}).mount(n)}if(document.querySelector("#next-add-form")){let n=document.createElement("div");document.querySelector("#next-add-form").appendChild(n),y({render:()=>C(hs,{challenge_id:window.CHALLENGE_ID})}).mount(n)}if(document.querySelector("#comment-box")){let n=document.createElement("div");document.querySelector("#comment-box").appendChild(n),y({render:()=>C(J,{challenge_id:window.CHALLENGE_ID})}).mount(n)}g.get(r.config.urlRoot+"/api/v1/challenges/types",function(n){const a=n.data;N(a.standard),g("#create-chals-select input[name=type]").change(function(){let i=a[this.value];N(i)})})});
