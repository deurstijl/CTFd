import{u as k,x as D,C as c,M as C,$ as l,U as f}from"./main-fLwNSudD.js";import{c as p,u as h}from"../graphs-Y-qJTCLC.js";import{C as j}from"../CommentBox-ktkeyXln.js";import"../echarts.common-BBHlT8Fy.js";function L(r){r.preventDefault();const n=l("#user-info-create-form").serializeJSON(!0);console.log(n),n.fields=[];for(const a in n)if(a.match(/fields\[\d+\]/)){let o={},s=parseInt(a.slice(7,-1));o.field_id=s,o.value=n[a],n.fields.push(o),delete n[a]}let e="/api/v1/users";n.notify===!0&&(e=`${e}?notify=true`),delete n.notify,c.fetch(e,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(a){return a.json()}).then(function(a){if(a.success){const o=a.data.id;window.location=c.config.urlRoot+"/admin/users/"+o}else l("#user-info-create-form > #results").empty(),Object.keys(a.errors).forEach(function(o,s){l("#user-info-create-form > #results").append(f({type:"error",body:a.errors[o]}));const d=l("#user-info-form").find("input[name={0}]".format(o)),u=l(d);u.addClass("input-filled-invalid"),u.removeClass("input-filled-valid")})})}function O(r){r.preventDefault();const n=l("#user-info-edit-form").serializeJSON(!0);n.fields=[];for(const e in n)if(e.match(/fields\[\d+\]/)){let t={},a=parseInt(e.slice(7,-1));t.field_id=a,t.value=n[e],n.fields.push(t),delete n[e]}c.fetch("/api/v1/users/"+window.USER_ID,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){e.success?window.location.reload():(l("#user-info-edit-form > #results").empty(),Object.keys(e.errors).forEach(function(t,a){l("#user-info-edit-form > #results").append(f({type:"error",body:e.errors[t]}));const o=l("#user-info-edit-form").find("input[name={0}]".format(t)),s=l(o);s.addClass("input-filled-invalid"),s.removeClass("input-filled-valid")}))})}function $(r){r.preventDefault();const n=window.USER_NAME||"this user";confirm(`Are you sure you want to delete "${n}"?`)&&c.fetch(`/api/v1/users/${window.USER_ID}`,{method:"DELETE",credentials:"same-origin"}).then(t=>t.json()).then(t=>{t.success?window.location=`${c.config.urlRoot}/admin/users`:alert("Failed to delete user.")}).catch(t=>{console.error("Delete failed:",t),alert("Unexpected error while deleting the user.")})}function T(r){r.preventDefault();const n=l("#user-award-form").serializeJSON(!0);n.user_id=window.USER_ID,c.fetch("/api/v1/awards",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){e.success?window.location.reload():(l("#user-award-form > #results").empty(),Object.keys(e.errors).forEach(function(t,a){l("#user-award-form > #results").append(f({type:"error",body:e.errors[t]}));const o=l("#user-award-form").find("input[name={0}]".format(t)),s=l(o);s.addClass("input-filled-invalid"),s.removeClass("input-filled-valid")}))})}function x(r){r.preventDefault();var n=l("#user-mail-form").serializeJSON(!0);c.fetch("/api/v1/users/"+window.USER_ID+"/email",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){e.success?(l("#user-mail-form > #results").append(f({type:"success",body:"E-Mail sent successfully!"})),l("#user-mail-form").find("input[type=text], textarea").val("")):(l("#user-mail-form > #results").empty(),Object.keys(e.errors).forEach(function(t,a){l("#user-mail-form > #results").append(f({type:"error",body:e.errors[t]}));var o=l("#user-mail-form").find("input[name={0}], textarea[name={0}]".format(t)),s=l(o);s.addClass("input-filled-invalid"),s.removeClass("input-filled-valid")}))})}function B(r){r.preventDefault();const n=document.querySelectorAll("input[data-submission-type='incorrect']:checked"),e=Array.from(n).map(s=>s.dataset.submissionId),t=e.length===1?"submission":"submissions";if(e.length===0){alert("Please select at least one submission to mark as correct.");return}if(!confirm(`Are you sure you want to mark ${e.length} ${t} correct?`))return;const o=e.map(s=>c.fetch(`/api/v1/submissions/${s}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({type:"correct"})}));Promise.all(o).then(()=>{window.location.reload()}).catch(s=>{console.error("Failed to correct submissions:",s),alert("An error occurred while updating submissions.")})}function S(r,n){r.preventDefault();let e,t;switch(n){case"solves":e='input[data-submission-type="correct"]:checked',t="solve";break;case"fails":e='input[data-submission-type="incorrect"]:checked',t="fail";break;default:return}const a=document.querySelectorAll(e),o=Array.from(a).map(m=>m.dataset.submissionId);if(o.length===0){alert(`Please select at least one ${t} to delete.`);return}const s=o.length===1?t:`${t}s`;if(!confirm(`Are you sure you want to delete ${o.length} ${s}?`))return;const u=o.map(m=>c.api.delete_submission({submissionId:m}));Promise.all(u).then(()=>{window.location.reload()}).catch(m=>{console.error(`Failed to delete ${s}:`,m),alert(`An error occurred while deleting ${s}.`)})}function P(r){r.preventDefault();const n=document.querySelectorAll("input[data-award-id]:checked"),e=Array.from(n).map(s=>s.dataset.awardId),t=e.length===1?"award":"awards";if(e.length===0){alert("Please select at least one award to delete.");return}if(!confirm(`Are you sure you want to delete ${e.length} ${t}?`))return;const o=e.map(s=>c.fetch(`/api/v1/awards/${s}`,{method:"DELETE",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}));Promise.all(o).then(()=>{window.location.reload()}).catch(s=>{console.error("Award deletion failed:",s),alert("An error occurred while deleting awards.")})}function N(r){r.preventDefault();const n=document.querySelectorAll("input[data-missing-challenge-id]:checked"),e=Array.from(n).map(d=>d.dataset.missingChallengeId),t=e.length===1?"challenge":"challenges";if(e.length===0){alert("Please select at least one challenge to mark as solved.");return}const a=window.USER_NAME||"this user";if(!confirm(`Are you sure you want to mark ${e.length} ${t} correct for ${a}?`))return;const s=e.map(d=>{const u={provided:"MARKED AS SOLVED BY ADMIN",user_id:window.USER_ID,team_id:window.TEAM_ID,challenge_id:d,type:"correct"};return c.fetch("/api/v1/submissions",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(u)})});Promise.all(s).then(()=>{window.location.reload()}).catch(d=>{console.error("Failed to mark challenges as solved:",d),alert("An error occurred while marking challenges as solved.")})}const _={team:[r=>c.api.get_team_solves({teamId:r}),r=>c.api.get_team_fails({teamId:r}),r=>c.api.get_team_awards({teamId:r})],user:[r=>c.api.get_user_solves({userId:r}),r=>c.api.get_user_fails({userId:r}),r=>c.api.get_user_awards({userId:r})]},U=(r,n,e,t)=>{let[a,o,s]=_[r];Promise.all([a(t),o(t),s(t)]).then(d=>{p("score_graph","#score-graph",d,r,n,e,t),p("category_breakdown","#categories-pie-graph",d,r,n,e,t),p("solve_percentages","#keys-pie-graph",d,r,n,e,t)})},q=(r,n,e,t)=>{let[a,o,s]=_[r];Promise.all([a(t),o(t),s(t)]).then(d=>{h("score_graph","#score-graph",d,r,n,e,t),h("category_breakdown","#categories-pie-graph",d,r,n,e,t),h("solve_percentages","#keys-pie-graph",d,r,n,e,t)})};document.addEventListener("DOMContentLoaded",()=>{var u,m,g,y,w,v,E,b,A;function r(i){const I=document.getElementById(i);I&&new C(I).toggle()}document.querySelectorAll(".delete-user").forEach(i=>i.addEventListener("click",$)),document.querySelectorAll(".edit-user").forEach(i=>i.addEventListener("click",()=>r("user-info-modal"))),document.querySelectorAll(".award-user").forEach(i=>i.addEventListener("click",()=>r("user-award-modal"))),document.querySelectorAll(".email-user").forEach(i=>i.addEventListener("click",()=>r("user-email-modal"))),document.querySelectorAll(".addresses-user").forEach(i=>i.addEventListener("click",()=>r("user-addresses-modal"))),(u=document.getElementById("user-mail-form"))==null||u.addEventListener("submit",x),(m=document.getElementById("solves-delete-button"))==null||m.addEventListener("click",i=>{S(i,"solves")}),(g=document.getElementById("correct-fail-button"))==null||g.addEventListener("click",B),(y=document.getElementById("fails-delete-button"))==null||y.addEventListener("click",i=>{S(i,"fails")}),(w=document.getElementById("awards-delete-button"))==null||w.addEventListener("click",i=>{P(i)}),(v=document.getElementById("missing-solve-button"))==null||v.addEventListener("click",i=>{N(i)}),(E=document.getElementById("user-info-create-form"))==null||E.addEventListener("submit",L),(b=document.getElementById("user-info-edit-form"))==null||b.addEventListener("submit",O),(A=document.getElementById("user-award-form"))==null||A.addEventListener("submit",T);const n=document.getElementById("comment-box");if(n){const i=document.createElement("div");n.appendChild(i),k({render:()=>D(j,{type:"user",id:window.USER_ID})}).mount(i)}let{type:e,id:t,name:a,account_id:o}=window.stats_data||{},s;const d=document.getElementById("user-statistics-modal");d&&(d.addEventListener("shown.bs.modal",()=>{U(e,t,a,o),s=setInterval(()=>{q(e,t,a,o)},3e5)}),d.addEventListener("hidden.bs.modal",()=>{clearInterval(s)}),document.querySelectorAll(".statistics-user").forEach(i=>i.addEventListener("click",()=>r("user-statistics-modal"))))});
