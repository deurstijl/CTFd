import{_ as v,c as r,o as d,a as n,w as g,v as F,b as S,C as o,d as T,e as R,f as N,r as D,g as k,h as H,F as _,i as b,$ as c,t as p,j as I,k as f,l as j,T as z,m as w,n as E,p as P,q as x,s as L,u as U,x as J,y,z as C,A as M,B as V,D as B}from"./main--AmmKLiY.js";import"../tab-DbnFN3P6.js";import{C as K}from"../CommentBox-u26BBQoR.js";const Y={name:"StaticFlagForm",props:{challenge_id:Number,mode:{type:String,default:"create"},initialData:{type:Object,default:()=>({})}},data(){return{flag:this.initialData.content||"",data:this.initialData.data||""}},methods:{submit(){const t={type:"static",content:this.flag,data:this.data};this.challenge_id&&(t.challenge=this.challenge_id),this.mode==="edit"&&(t.id=this.initialData.id),this.$emit("submit",t)}}},Q={class:"form-group"},Z={class:"form-group"};function W(t,e,l,u,a,i){return d(),r("div",null,[n("div",Q,[e[3]||(e[3]=n("label",{for:"static-flag"},"Flag",-1)),g(n("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.flag=s),type:"text",class:"form-control",id:"static-flag",name:"flag",required:""},null,512),[[F,a.flag]])]),n("div",Z,[e[4]||(e[4]=n("label",{for:"static-data"},"Data (optional)",-1)),g(n("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.data=s),type:"text",class:"form-control",id:"static-data",name:"data"},null,512),[[F,a.data]])]),n("button",{class:"btn btn-success float-right",onClick:e[2]||(e[2]=(...s)=>i.submit&&i.submit(...s))}," Create Flag ")])}const O=v(Y,[["render",W]]),X={name:"RegexFlagForm",props:{challenge_id:{type:Number,default:null},mode:{type:String,default:"create"},initialData:{type:Object,default:()=>({})}},data(){return{flag:this.initialData.content||"",data:this.initialData.data||"true"}},methods:{submit(){const t={type:"regex",content:this.flag,data:this.data};this.challenge_id&&(t.challenge=this.challenge_id),this.mode==="edit"&&this.initialData.id&&(t.id=this.initialData.id),this.$emit("submit",t)}}},ee={class:"form-group"},te={class:"form-group"};function ne(t,e,l,u,a,i){return d(),r("div",null,[n("div",ee,[e[3]||(e[3]=n("label",{for:"regex-flag"},"Regular Expression",-1)),g(n("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.flag=s),type:"text",class:"form-control",id:"regex-flag",name:"flag",placeholder:"e.g. ^CTF\\{[a-zA-Z0-9]+\\}$",required:""},null,512),[[F,a.flag]])]),n("div",te,[e[5]||(e[5]=n("label",{for:"regex-data"},"Case Sensitive",-1)),g(n("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.data=s),class:"form-control custom-select",id:"regex-data",name:"data"},e[4]||(e[4]=[n("option",{value:"true"},"Yes",-1),n("option",{value:"false"},"No",-1)]),512),[[S,a.data]])]),n("button",{class:"btn btn-success float-right",onClick:e[2]||(e[2]=(...s)=>i.submit&&i.submit(...s))}," Create Flag ")])}const G=v(X,[["render",ne]]),se={name:"FlagCreationForm",props:{challenge_id:Number},components:{StaticFlagForm:O,RegexFlagForm:G},data(){return{selectedType:""}},computed:{selectedTypeComponent(){switch(this.selectedType){case"static":return"StaticFlagForm";case"regex":return"RegexFlagForm";default:return null}}},methods:{submitFlag(t){o.fetch("/api/v1/flags",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{this.$emit("refreshFlags",this.$options.name)})}}},ie={id:"flag-create-modal",class:"modal fade",tabindex:"-1"},le={class:"modal-dialog modal-lg"},ae={class:"modal-content"},oe={class:"modal-body"};function de(t,e,l,u,a,i){return d(),r("div",ie,[n("div",le,[n("div",ae,[e[4]||(e[4]=T('<div class="modal-header text-center"><div class="container"><div class="row"><div class="col-md-12"><h3>Create Flag</h3></div></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>',1)),n("div",oe,[e[2]||(e[2]=n("label",{for:"create-keys-select",class:"control-label"}," Choose Flag Type ",-1)),g(n("select",{class:"form-control custom-select","onUpdate:modelValue":e[0]||(e[0]=s=>a.selectedType=s)},e[1]||(e[1]=[n("option",{disabled:"",value:""},"--",-1),n("option",{value:"static"},"static",-1),n("option",{value:"regex"},"regex",-1)]),512),[[S,a.selectedType]]),e[3]||(e[3]=n("br",null,null,-1)),i.selectedTypeComponent?(d(),R(D(i.selectedTypeComponent),{key:0,challenge_id:l.challenge_id,onSubmit:i.submitFlag},null,40,["challenge_id","onSubmit"])):N("",!0)])])])])}const re=v(se,[["render",de]]),ce={name:"FlagEditForm",props:{flag_id:Number},components:{StaticFlagForm:O,RegexFlagForm:G},data(){return{flag:null}},computed:{selectedTypeComponent(){if(!this.flag)return null;switch(this.flag.type){case"static":return"StaticFlagForm";case"regex":return"RegexFlagForm";default:return null}}},watch:{flag_id:{immediate:!0,handler(t){t!==null&&this.loadFlag()}}},methods:{loadFlag(){o.fetch(`/api/v1/flags/${this.flag_id}`,{method:"GET"}).then(t=>t.json()).then(t=>{this.flag=t.data})},updateFlag(t){o.fetch(`/api/v1/flags/${this.flag_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{this.$emit("refreshFlags",this.$options.name)})}}},ue={id:"flag-edit-modal",class:"modal fade",tabindex:"-1"},he={class:"modal-dialog modal-lg"},me={class:"modal-content"},pe={class:"modal-body"};function fe(t,e,l,u,a,i){return d(),r("div",ue,[n("div",he,[n("div",me,[e[0]||(e[0]=T('<div class="modal-header text-center"><div class="container"><div class="row"><div class="col-md-12"><h3>Edit Flag</h3></div></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>',1)),n("div",pe,[a.flag&&i.selectedTypeComponent?(d(),R(D(i.selectedTypeComponent),{key:0,mode:"edit",initialData:a.flag,onSubmit:i.updateFlag},null,40,["initialData","onSubmit"])):N("",!0)])])])])}const ge=v(ce,[["render",fe]]),ve={components:{FlagCreationForm:re,FlagEditForm:ge},props:{challenge_id:Number},data:function(){return{flags:[],editing_flag_id:null}},methods:{loadFlags:function(){o.fetch(`/api/v1/challenges/${this.$props.challenge_id}/flags`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{t.success&&(this.flags=t.data)})},refreshFlags(t){this.loadFlags();let e;switch(t){case"FlagEditForm":e=this.$refs.FlagEditForm.$el,c(e).modal("hide");break;case"FlagCreationForm":e=this.$refs.FlagCreationForm.$el,c(e).modal("hide");break}},addFlag:function(){let t=this.$refs.FlagCreationForm.$el;c(t).modal()},editFlag:function(t){this.editing_flag_id=t;let e=this.$refs.FlagEditForm.$el;c(e).modal()},deleteFlag:function(t){confirm("Are you sure you'd like to delete this flag?")&&o.fetch(`/api/v1/flags/${t}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{e.success&&this.loadFlags()})}},created(){this.loadFlags()}},_e={id:"flagsboard",class:"table table-striped"},be=["name"],ye={class:"text-center"},$e={class:"text-break"},Ce={class:"flag-content"},Fe={class:"text-center"},Te=["flag-id","flag-type","onClick"],He=["flag-id","onClick"],we={class:"col-md-12"};function Ee(t,e,l,u,a,i){const s=k("FlagCreationForm"),m=k("FlagEditForm");return d(),r("div",null,[n("div",null,[H(s,{ref:"FlagCreationForm",challenge_id:l.challenge_id,onRefreshFlags:i.refreshFlags},null,8,["challenge_id","onRefreshFlags"])]),n("div",null,[H(m,{ref:"FlagEditForm",flag_id:t.editing_flag_id,onRefreshFlags:i.refreshFlags},null,8,["flag_id","onRefreshFlags"])]),n("table",_e,[e[1]||(e[1]=n("thead",null,[n("tr",null,[n("td",{class:"text-center"},[n("b",null,"Type")]),n("td",{class:"text-center"},[n("b",null,"Flag")]),n("td",{class:"text-center"},[n("b",null,"Settings")])])],-1)),n("tbody",null,[(d(!0),r(_,null,b(t.flags,h=>(d(),r("tr",{name:h.id,key:h.id},[n("td",ye,p(h.type),1),n("td",$e,[n("pre",Ce,p(h.content),1)]),n("td",Fe,[n("i",{role:"button",class:"btn-fa fas fa-edit edit-flag","flag-id":h.id,"flag-type":h.type,onClick:q=>i.editFlag(h.id)},null,8,Te),n("i",{role:"button",class:"btn-fa fas fa-times delete-flag","flag-id":h.id,onClick:q=>i.deleteFlag(h.id)},null,8,He)])],8,be))),128))])]),n("div",we,[n("button",{id:"flag-add-button",class:"btn btn-success d-inline-block float-right",onClick:e[0]||(e[0]=h=>i.addFlag())}," Create Flag ")])])}const ke=v(ve,[["render",Ee]]),je={props:{challenge_id:Number},data:function(){return{challenges:[],requirements:{},selectedRequirements:[],selectedAnonymize:!1}},computed:{newRequirements:function(){let t=this.requirements.prerequisites||[],e=this.requirements.anonymize||!1,l=JSON.stringify(t.sort())!==JSON.stringify(this.selectedRequirements.sort()),u=e!==this.selectedAnonymize;return l||u},requiredChallenges:function(){const t=this.requirements.prerequisites||[];return this.challenges.filter(e=>e.id!==this.$props.challenge_id&&t.includes(e.id))},otherChallenges:function(){const t=this.requirements.prerequisites||[];return this.challenges.filter(e=>e.id!==this.$props.challenge_id&&!t.includes(e.id))}},methods:{loadChallenges:function(){o.fetch("/api/v1/challenges?view=admin",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{t.success&&(this.challenges=t.data)})},getChallengeNameById:function(t){let e=this.challenges.find(l=>l.id===t);return e?e.name:""},loadRequirements:function(){o.fetch(`/api/v1/challenges/${this.$props.challenge_id}/requirements`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{t.success&&(this.requirements=t.data||{},this.selectedRequirements=this.requirements.prerequisites||[],this.selectedAnonymize=this.requirements.anonymize||!1)})},updateRequirements:function(){const e={requirements:{prerequisites:this.selectedRequirements}};this.selectedAnonymize&&(e.requirements.anonymize=!0),o.fetch(`/api/v1/challenges/${this.$props.challenge_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(l=>l.json()).then(l=>{l.success&&this.loadRequirements()})}},created(){this.loadChallenges(),this.loadRequirements()}},xe={class:"form-group scrollbox"},Se={class:"form-check-label cursor-pointer"},qe=["value"],Ae={class:"form-check-label cursor-pointer"},Re=["value"],Ne={class:"form-group"},De={class:"form-group"},Le=["disabled"];function Ve(t,e,l,u,a,i){return d(),r("div",null,[n("form",{onSubmit:e[3]||(e[3]=w((...s)=>i.updateRequirements&&i.updateRequirements(...s),["prevent"]))},[n("div",xe,[H(z,{name:"flip-list"},{default:I(()=>[(d(!0),r(_,null,b(i.requiredChallenges,s=>(d(),r("div",{class:"form-check",key:s.id},[n("label",Se,[g(n("input",{class:"form-check-input",type:"checkbox",value:s.id,"onUpdate:modelValue":e[0]||(e[0]=m=>t.selectedRequirements=m)},null,8,qe),[[j,t.selectedRequirements]]),f(" "+p(s.name),1)])]))),128)),(d(!0),r(_,null,b(i.otherChallenges,s=>(d(),r("div",{class:"form-check",key:s.id},[n("label",Ae,[g(n("input",{class:"form-check-input",type:"checkbox",value:s.id,"onUpdate:modelValue":e[1]||(e[1]=m=>t.selectedRequirements=m)},null,8,Re),[[j,t.selectedRequirements]]),f(" "+p(s.name),1)])]))),128))]),_:1})]),n("div",Ne,[e[5]||(e[5]=n("label",null,[n("b",null,"Behavior if not unlocked")],-1)),g(n("select",{class:"form-control custom-select",name:"anonymize","onUpdate:modelValue":e[2]||(e[2]=s=>t.selectedAnonymize=s)},e[4]||(e[4]=[n("option",{value:!1},"Hidden",-1),n("option",{value:!0},"Anonymized",-1)]),512),[[S,t.selectedAnonymize]])]),n("div",De,[n("button",{class:"btn btn-success float-right",disabled:!i.newRequirements}," Save ",8,Le)])],32)])}const Oe=v(je,[["render",Ve],["__scopeId","data-v-a3fa86b4"]]),Ge={props:{challenge_id:Number},data:function(){return{topics:[],topicValue:"",searchedTopic:"",topicResults:[],selectedResultIdx:0,awaitingSearch:!1}},methods:{loadTopics:function(){o.fetch(`/api/v1/challenges/${this.$props.challenge_id}/topics`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{t.success&&(this.topics=t.data)})},searchTopics:function(){if(this.selectedResultIdx=0,this.topicValue==""){this.topicResults=[];return}o.fetch(`/api/v1/topics?field=value&q=${this.topicValue}`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{t.success&&(this.topicResults=t.data.slice(0,10))})},addTopic:function(){let t;if(this.selectedResultIdx===0)t=this.topicValue;else{let l=this.selectedResultIdx-1;t=this.topicResults[l].value}const e={value:t,challenge:this.$props.challenge_id,type:"challenge"};o.fetch("/api/v1/topics",{method:"POST",body:JSON.stringify(e)}).then(l=>l.json()).then(l=>{l.success&&(this.topicValue="",this.loadTopics())})},deleteTopic:function(t){o.fetch(`/api/v1/topics?type=challenge&target_id=${t}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{e.success&&this.loadTopics()})},moveCursor:function(t){switch(t){case"up":this.selectedResultIdx&&(this.selectedResultIdx-=1);break;case"down":this.selectedResultIdx<this.topicResults.length&&(this.selectedResultIdx+=1);break}},selectTopic:function(t){t===void 0&&(t=this.selectedResultIdx);let e=this.topicResults[t];this.topicValue=e.value}},watch:{topicValue:function(t){this.awaitingSearch===!1&&setTimeout(()=>{this.searchTopics(),this.awaitingSearch=!1},500),this.awaitingSearch=!0}},created(){this.loadTopics()}},Ie={class:"col-md-12"},ze={id:"challenge-topics",class:"my-3"},Pe={class:"mr-1"},Ue=["onClick"],Je={class:"form-group"},Me={class:"form-group"},Be={class:"list-group"},Ke=["onClick"];function Ye(t,e,l,u,a,i){return d(),r("div",Ie,[n("div",ze,[(d(!0),r(_,null,b(t.topics,s=>(d(),r("h5",{class:"challenge-tag",key:s.id},[n("span",Pe,p(s.value),1),n("a",{class:"btn-fa delete-tag",onClick:m=>i.deleteTopic(s.id)}," ×",8,Ue)]))),128))]),n("div",Je,[e[4]||(e[4]=n("label",null,[f(" Topic "),n("br"),n("small",{class:"text-muted"},"Type topic and press Enter")],-1)),g(n("input",{id:"tags-add-input",maxlength:"255",type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=s=>t.topicValue=s),onKeyup:[e[1]||(e[1]=E(s=>i.moveCursor("down"),["down"])),e[2]||(e[2]=E(s=>i.moveCursor("up"),["up"])),e[3]||(e[3]=E(s=>i.addTopic(),["enter"]))]},null,544),[[F,t.topicValue]])]),n("div",Me,[n("ul",Be,[(d(!0),r(_,null,b(t.topicResults,(s,m)=>(d(),r("li",{class:P({"list-group-item":!0,active:m+1===t.selectedResultIdx}),key:s.id,onClick:h=>i.selectTopic(m)},p(s.value),11,Ke))),128))])])])}const Qe=v(Ge,[["render",Ye]]),Ze={props:{challenge_id:Number},data:function(){return{tags:[],tagValue:""}},methods:{loadTags:function(){o.fetch(`/api/v1/challenges/${this.$props.challenge_id}/tags`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{t.success&&(this.tags=t.data)})},addTag:function(){if(this.tagValue){const t={value:this.tagValue,challenge:this.$props.challenge_id};o.api.post_tag_list({},t).then(e=>{e.success&&(this.tagValue="",this.loadTags())})}},deleteTag:function(t){o.api.delete_tag({tagId:t}).then(e=>{e.success&&this.loadTags()})}},created(){this.loadTags()}},We={class:"col-md-12"},Xe={id:"challenge-tags",class:"my-3"},et=["onClick"],tt={class:"form-group"};function nt(t,e,l,u,a,i){return d(),r("div",We,[n("div",Xe,[(d(!0),r(_,null,b(t.tags,s=>(d(),r("span",{class:"badge badge-primary mx-1 challenge-tag",key:s.id},[n("span",null,p(s.value),1),n("a",{class:"btn-fa delete-tag",onClick:m=>i.deleteTag(s.id)}," ×",8,et)]))),128))]),n("div",tt,[e[2]||(e[2]=n("label",null,[f("Tag "),n("br"),n("small",{class:"text-muted"},"Type tag and press Enter")],-1)),g(n("input",{id:"tags-add-input",maxlength:"80",type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=s=>t.tagValue=s),onKeyup:e[1]||(e[1]=E(s=>i.addTag(),["enter"]))},null,544),[[F,t.tagValue]])])])}const st=v(Ze,[["render",nt]]),it={props:{challenge_id:Number},data:function(){return{files:[],urlRoot:o.config.urlRoot}},methods:{loadFiles:function(){o.fetch(`/api/v1/challenges/${this.$props.challenge_id}/files`,{method:"GET"}).then(t=>t.json()).then(t=>{t.success&&(this.files=t.data)})},addFiles:function(){let t={challenge:this.$props.challenge_id,type:"challenge"},e=this.$refs.FileUploadForm;L.files.upload(e,t,l=>{setTimeout(()=>{this.loadFiles()},700)})},deleteFile:function(t){x({title:"Delete Files",body:"Are you sure you want to delete this file?",success:()=>{o.fetch(`/api/v1/files/${t}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{e.success&&this.loadFiles()})}})}},created(){this.loadFiles()}},lt={id:"filesboard",class:"table table-striped"},at={class:"text-left"},ot=["href"],dt={class:"d-flex flex-row align-items-center"},rt={class:"d-inline-block mr-2 small text-muted"},ct={class:"text-center"},ut=["onClick"],ht={class:"col-md-12 mt-3"};function mt(t,e,l,u,a,i){return d(),r("div",null,[n("table",lt,[e[2]||(e[2]=n("thead",null,[n("tr",null,[n("td",{class:"text-center"},[n("b",null,"File")]),n("td",{class:"text-center"},[n("b",null,"Settings")])])],-1)),n("tbody",null,[(d(!0),r(_,null,b(t.files,s=>(d(),r("tr",{key:s.id},[n("td",at,[n("a",{href:`${t.urlRoot}/files/${s.location}`},p(s.location.split("/").pop()),9,ot),n("div",dt,[e[1]||(e[1]=n("strong",{class:"mr-2 small"}," SHA1: ",-1)),n("span",rt,p(s.sha1sum||"null"),1)])]),n("td",ct,[n("i",{role:"button",class:"btn-fa fas fa-times delete-file",onClick:m=>i.deleteFile(s.id)},null,8,ut)])]))),128))])]),n("div",ht,[n("form",{method:"POST",ref:"FileUploadForm",onSubmit:e[0]||(e[0]=w((...s)=>i.addFiles&&i.addFiles(...s),["prevent"]))},e[3]||(e[3]=[T('<div class="form-group"><input class="form-control-file" id="file" multiple="" name="file" required="" type="file"><sub class="text-muted"> Attach multiple files using Control+Click or Cmd+Click. </sub></div><div class="form-group"><input class="btn btn-success float-right" id="_submit" name="_submit" type="submit" value="Upload"></div>',2)]),544)])])}const pt=v(it,[["render",mt]]),ft={name:"HintCreationForm",props:{challenge_id:Number,hints:Array},data:function(){return{cost:0,selectedHints:[]}},methods:{getCost:function(){return this.cost||0},getContent:function(){return this.$refs.content.value},getTitle:function(){return this.$refs.title.value},submitHint:function(){let t={challenge_id:this.$props.challenge_id,content:this.getContent(),cost:this.getCost(),title:this.getTitle(),requirements:{prerequisites:this.selectedHints}};CTFd.fetch("/api/v1/hints",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{e.success&&this.$emit("refreshHints",this.$options.name)})}}},gt={class:"modal fade",tabindex:"-1"},vt={class:"modal-dialog"},_t={class:"modal-content"},bt={class:"modal-body"},yt={class:"container"},$t={class:"row"},Ct={class:"col-md-12"},Ft={class:"form-group"},Tt={type:"text",class:"form-control",name:"title",ref:"title"},Ht={class:"form-group"},wt={type:"text",class:"form-control markdown",name:"content",rows:"7",ref:"content"},Et={class:"form-group"},kt={class:"form-group"},jt={class:"form-check-label cursor-pointer"},xt=["value"];function St(t,e,l,u,a,i){return d(),r("div",gt,[n("div",vt,[n("div",_t,[e[9]||(e[9]=T('<div class="modal-header text-center"><div class="container"><div class="row"><div class="col-md-12"><h3>Hint</h3></div></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>',1)),n("form",{method:"POST",onSubmit:e[2]||(e[2]=w((...s)=>i.submitHint&&i.submitHint(...s),["prevent"]))},[n("div",bt,[n("div",yt,[n("div",$t,[n("div",Ct,[n("div",Ft,[e[3]||(e[3]=n("label",null,[f(" Title"),n("br"),n("small",null,"Content displayed before hint unlocking")],-1)),n("input",Tt,null,512)]),n("div",Ht,[e[4]||(e[4]=n("label",null,[f(" Hint"),n("br"),n("small",null,"Markdown & HTML are supported")],-1)),n("textarea",wt,null,512)]),n("div",Et,[e[5]||(e[5]=n("label",null,[f(" Cost"),n("br"),n("small",null,"How many points it costs to see your hint.")],-1)),g(n("input",{type:"number",class:"form-control",name:"cost","onUpdate:modelValue":e[0]||(e[0]=s=>t.cost=s)},null,512),[[F,t.cost,void 0,{lazy:!0}]])]),n("div",kt,[e[6]||(e[6]=n("label",null,[f(" Requirements"),n("br"),n("small",null,"Hints that must be unlocked before unlocking this hint")],-1)),(d(!0),r(_,null,b(l.hints,s=>(d(),r("div",{class:"form-check",key:s.id},[n("label",jt,[g(n("input",{class:"form-check-input",type:"checkbox",value:s.id,"onUpdate:modelValue":e[1]||(e[1]=m=>t.selectedHints=m)},null,8,xt),[[j,t.selectedHints]]),f(" "+p(s.cost)+" - "+p(s.id),1)])]))),128))]),e[7]||(e[7]=n("input",{type:"hidden",id:"hint-id-for-hint",name:"id"},null,-1))])])])]),e[8]||(e[8]=T('<div class="modal-footer"><div class="container"><div class="row"><div class="col-md-12"><button class="btn btn-primary float-right">Submit</button></div></div></div></div>',1))],32)])])])}const qt=v(ft,[["render",St]]),At={name:"HintEditForm",props:{challenge_id:Number,hint_id:Number,hints:Array},data:function(){return{cost:0,title:null,content:null,selectedHints:[]}},computed:{otherHints:function(){return this.hints.filter(t=>t.id!==this.$props.hint_id)}},watch:{hint_id:{immediate:!0,handler(t,e){t!==null&&this.loadHint()}}},methods:{loadHint:function(){o.fetch(`/api/v1/hints/${this.$props.hint_id}?preview=true`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{var e;if(t.success){let l=t.data;this.cost=l.cost,this.title=l.title,this.content=l.content,this.selectedHints=((e=l.requirements)==null?void 0:e.prerequisites)||[];let u=this.$refs.content;U(u),setTimeout(()=>{u.mde.codemirror.getDoc().setValue(u.value),this._forceRefresh()},200)}})},_forceRefresh:function(){this.$refs.content.mde.codemirror.refresh()},getCost:function(){return this.cost||0},getContent:function(){return this._forceRefresh(),this.$refs.content.mde.codemirror.getDoc().getValue()},getTitle:function(){return this.$refs.title.value},updateHint:function(){let t={challenge_id:this.$props.challenge_id,content:this.getContent(),cost:this.getCost(),title:this.getTitle(),requirements:{prerequisites:this.selectedHints}};o.fetch(`/api/v1/hints/${this.$props.hint_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{e.success&&this.$emit("refreshHints",this.$options.name)})}},mounted(){this.hint_id&&this.loadHint()},created(){this.hint_id&&this.loadHint()}},Rt={class:"modal fade",tabindex:"-1"},Nt={class:"modal-dialog"},Dt={class:"modal-content"},Lt={class:"modal-body"},Vt={class:"container"},Ot={class:"row"},Gt={class:"col-md-12"},It={class:"form-group"},zt=["value"],Pt={class:"form-group"},Ut=["value"],Jt={class:"form-group"},Mt={class:"form-group"},Bt={class:"form-check-label cursor-pointer"},Kt=["value"];function Yt(t,e,l,u,a,i){return d(),r("div",Rt,[n("div",Nt,[n("div",Dt,[e[8]||(e[8]=T('<div class="modal-header text-center"><div class="container"><div class="row"><div class="col-md-12"><h3>Hint</h3></div></div></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>',1)),n("form",{method:"POST",onSubmit:e[2]||(e[2]=w((...s)=>i.updateHint&&i.updateHint(...s),["prevent"]))},[n("div",Lt,[n("div",Vt,[n("div",Ot,[n("div",Gt,[n("div",It,[e[3]||(e[3]=n("label",null,[f(" Title"),n("br"),n("small",null,"Content displayed before hint unlocking")],-1)),n("input",{type:"text",class:"form-control",name:"title",value:this.title,ref:"title"},null,8,zt)]),n("div",Pt,[e[4]||(e[4]=n("label",null,[f(" Hint"),n("br"),n("small",null,"Markdown & HTML are supported")],-1)),n("textarea",{type:"text",class:"form-control",name:"content",rows:"7",value:this.content,ref:"content"},null,8,Ut)]),n("div",Jt,[e[5]||(e[5]=n("label",null,[f(" Cost"),n("br"),n("small",null,"How many points it costs to see your hint.")],-1)),g(n("input",{type:"number",class:"form-control",name:"cost","onUpdate:modelValue":e[0]||(e[0]=s=>t.cost=s)},null,512),[[F,t.cost,void 0,{lazy:!0}]])]),n("div",Mt,[e[6]||(e[6]=n("label",null,[f(" Requirements"),n("br"),n("small",null,"Hints that must be unlocked before unlocking this hint")],-1)),(d(!0),r(_,null,b(i.otherHints,s=>(d(),r("div",{class:"form-check",key:s.id},[n("label",Bt,[g(n("input",{class:"form-check-input",type:"checkbox",value:s.id,"onUpdate:modelValue":e[1]||(e[1]=m=>t.selectedHints=m)},null,8,Kt),[[j,t.selectedHints]]),f(" "+p(s.content)+" - "+p(s.cost),1)])]))),128))])])])])]),e[7]||(e[7]=T('<div class="modal-footer"><div class="container"><div class="row"><div class="col-md-12"><button class="btn btn-primary float-right">Submit</button></div></div></div></div>',1))],32)])])])}const Qt=v(At,[["render",Yt]]),Zt={components:{HintCreationForm:qt,HintEditForm:Qt},props:{challenge_id:Number},data:function(){return{hints:[],editing_hint_id:null}},methods:{loadHints:async function(){let e=await(await o.fetch(`/api/v1/challenges/${this.$props.challenge_id}/hints`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}})).json();return this.hints=e.data,e.success},addHint:function(){let t=this.$refs.HintCreationForm.$el;$(t).modal()},editHint:function(t){this.editing_hint_id=t;let e=this.$refs.HintEditForm.$el;$(e).modal()},refreshHints:function(t){this.loadHints().then(e=>{if(e){let l;switch(t){case"HintCreationForm":l=this.$refs.HintCreationForm.$el,console.log(l),$(l).modal("hide");break;case"HintEditForm":l=this.$refs.HintEditForm.$el,$(l).modal("hide");break}}else alert("An error occurred while updating this hint. Please try again.")})},deleteHint:function(t){x({title:"Delete Hint",body:"Are you sure you want to delete this hint?",success:()=>{o.fetch(`/api/v1/hints/${t}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{e.success&&this.loadHints()})}})}},created(){this.loadHints()}},Wt={class:"table table-striped"},Xt={class:"text-center"},en={class:"text-center"},tn={class:"text-break"},nn={class:"text-center"},sn={class:"text-center"},ln=["onClick"],an=["onClick"],on={class:"col-md-12"};function dn(t,e,l,u,a,i){const s=k("HintCreationForm"),m=k("HintEditForm");return d(),r("div",null,[n("div",null,[H(s,{ref:"HintCreationForm",challenge_id:l.challenge_id,hints:t.hints,onRefreshHints:i.refreshHints},null,8,["challenge_id","hints","onRefreshHints"])]),n("div",null,[H(m,{ref:"HintEditForm",challenge_id:l.challenge_id,hint_id:t.editing_hint_id,hints:t.hints,onRefreshHints:i.refreshHints},null,8,["challenge_id","hint_id","hints","onRefreshHints"])]),n("table",Wt,[e[1]||(e[1]=n("thead",null,[n("tr",null,[n("td",{class:"text-center"},[n("b",null,"ID")]),n("td",{class:"text-center"},[n("b",null,"Title")]),n("td",{class:"text-center"},[n("b",null,"Hint")]),n("td",{class:"text-center"},[n("b",null,"Cost")]),n("td",{class:"text-center"},[n("b",null,"Settings")])])],-1)),n("tbody",null,[(d(!0),r(_,null,b(t.hints,h=>(d(),r("tr",{key:h.id},[n("td",Xt,p(h.type),1),n("td",en,p(h.title),1),n("td",tn,[n("pre",null,p(h.content),1)]),n("td",nn,p(h.cost),1),n("td",sn,[n("i",{role:"button",class:"btn-fa fas fa-edit",onClick:q=>i.editHint(h.id)},null,8,ln),n("i",{role:"button",class:"btn-fa fas fa-times",onClick:q=>i.deleteHint(h.id)},null,8,an)])]))),128))])]),n("div",on,[n("button",{class:"btn btn-success float-right",onClick:e[0]||(e[0]=(...h)=>i.addHint&&i.addHint(...h))}," Create Hint ")])])}const rn=v(Zt,[["render",dn]]),cn={props:{challenge_id:Number},data:function(){return{challenge:null,challenges:[],selected_id:null}},computed:{updateAvailable:function(){return this.challenge?this.selected_id!=this.challenge.next_id:!1},otherChallenges:function(){return this.challenges.filter(t=>t.id!==this.$props.challenge_id)}},methods:{loadData:function(){o.fetch(`/api/v1/challenges/${this.$props.challenge_id}`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{t.success&&(this.challenge=t.data,this.selected_id=t.data.next_id)})},loadChallenges:function(){o.fetch("/api/v1/challenges?view=admin",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{t.success&&(this.challenges=t.data)})},updateNext:function(){o.fetch(`/api/v1/challenges/${this.$props.challenge_id}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({next_id:this.selected_id!="null"?this.selected_id:null})}).then(t=>t.json()).then(t=>{t.success&&(this.loadData(),this.loadChallenges())})}},created(){this.loadData(),this.loadChallenges()}},un={class:"form-group"},hn=["value"],mn={class:"form-group"},pn=["disabled"];function fn(t,e,l,u,a,i){return d(),r("div",null,[n("form",{onSubmit:e[1]||(e[1]=w((...s)=>i.updateNext&&i.updateNext(...s),["prevent"]))},[n("div",un,[e[3]||(e[3]=n("label",null,[f(" Next Challenge "),n("br"),n("small",{class:"text-muted"},"Challenge to recommend after solving this challenge")],-1)),g(n("select",{class:"form-control custom-select","onUpdate:modelValue":e[0]||(e[0]=s=>t.selected_id=s)},[e[2]||(e[2]=n("option",{value:"null"},"--",-1)),(d(!0),r(_,null,b(i.otherChallenges,s=>(d(),r("option",{value:s.id,key:s.id},p(s.name),9,hn))),128))],512),[[S,t.selected_id]])]),n("div",mn,[n("button",{class:"btn btn-success float-right",disabled:!i.updateAvailable}," Save ",8,pn)])],32)])}const gn=v(cn,[["render",fn]]);function A(t){o._internal.challenge={},c.getScript(o.config.urlRoot+t.scripts.view,function(){let e=t.create;c("#create-chal-entry-div").html(e),B(),c.getScript(o.config.urlRoot+t.scripts.create,function(){c("#create-chal-entry-div form").submit(function(l){l.preventDefault();const u=c("#create-chal-entry-div form").serializeJSON();o.fetch("/api/v1/challenges",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(u)}).then(function(a){return a.json()}).then(function(a){if(a.success)c("#challenge-create-options #challenge_id").val(a.data.id),c("#challenge-create-options").modal();else{let i="";for(const s in a.errors)i+=a.errors[s].join(`
`),i+=`
`;V({title:"Error",body:i,button:"OK"})}})})})})}function vn(t){t.preventDefault();var e=c(t.target).serializeJSON(!0);let l={challenge_id:e.challenge_id,content:e.flag||"",type:e.flag_type,data:e.flag_data?e.flag_data:""},u=function(){o.fetch("/api/v1/challenges/"+e.challenge_id,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({state:e.state})}).then(function(a){return a.json()}).then(function(a){a.success&&setTimeout(function(){window.location=o.config.urlRoot+"/admin/challenges/"+e.challenge_id},700)})};Promise.all([new Promise(function(a,i){if(l.content.length==0){a();return}o.fetch("/api/v1/flags",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)}).then(function(s){a(s.json())})}),new Promise(function(a,i){let s=t.target,m={challenge:e.challenge_id,type:"challenge"};c(s.elements.file).val()&&L.files.upload(s,m),a()})]).then(a=>{u()})}c(()=>{if(c(".preview-challenge").click(function(t){let e=`${o.config.urlRoot}/admin/challenges/preview/${window.CHALLENGE_ID}`;c("#challenge-window").html(`<iframe src="${e}" height="100%" width="100%" frameBorder=0></iframe>`),c("#challenge-modal").modal()}),c(".comments-challenge").click(function(t){c("#challenge-comments-window").modal()}),c(".delete-challenge").click(function(t){x({title:"Delete Challenge",body:`Are you sure you want to delete <strong>${J(window.CHALLENGE_NAME)}</strong>`,success:function(){o.fetch("/api/v1/challenges/"+window.CHALLENGE_ID,{method:"DELETE"}).then(function(e){return e.json()}).then(function(e){e.success&&(window.location=o.config.urlRoot+"/admin/challenges")})}})}),c("#challenge-update-container > form").submit(function(t){t.preventDefault();var e=c(t.target).serializeJSON(!0);o.fetch("/api/v1/challenges/"+window.CHALLENGE_ID+"/flags",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(l){return l.json()}).then(function(l){let u=function(){o.fetch("/api/v1/challenges/"+window.CHALLENGE_ID,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(a){return a.json()}).then(function(a){if(a.success){switch(c(".challenge-state").text(a.data.state),a.data.state){case"visible":c(".challenge-state").removeClass("badge-danger").addClass("badge-success");break;case"hidden":c(".challenge-state").removeClass("badge-success").addClass("badge-danger");break}M({title:"Success",body:"Your challenge has been updated!"})}else{let i="";for(const s in a.errors)i+=a.errors[s].join(`
`),i+=`
`;V({title:"Error",body:i,button:"OK"})}})};l.data.length===0&&e.state==="visible"?x({title:"Missing Flags",body:"This challenge does not have any flags meaning it may be unsolveable. Are you sure you'd like to update this challenge?",success:u}):u()})}),c("#challenge-create-options form").submit(vn),document.querySelector("#challenge-flags")){let t=document.createElement("div");document.querySelector("#challenge-flags").appendChild(t),y({render:()=>C(ke,{challenge_id:window.CHALLENGE_ID})}).mount(t)}if(document.querySelector("#challenge-topics")){let t=document.createElement("div");document.querySelector("#challenge-topics").appendChild(t),y({render:()=>C(Qe,{challenge_id:window.CHALLENGE_ID})}).mount(t)}if(document.querySelector("#challenge-tags")){let t=document.createElement("div");document.querySelector("#challenge-tags").appendChild(t),y({render:()=>C(st,{challenge_id:window.CHALLENGE_ID})}).mount(t)}if(document.querySelector("#prerequisite-add-form")){let t=document.createElement("div");document.querySelector("#prerequisite-add-form").appendChild(t),y({render:()=>C(Oe,{challenge_id:window.CHALLENGE_ID})}).mount(t)}if(document.querySelector("#challenge-files")){let t=document.createElement("div");document.querySelector("#challenge-files").appendChild(t),y({render:()=>C(pt,{challenge_id:window.CHALLENGE_ID})}).mount(t)}if(document.querySelector("#challenge-hints")){let t=document.createElement("div");document.querySelector("#challenge-hints").appendChild(t),y({render:()=>C(rn,{challenge_id:window.CHALLENGE_ID})}).mount(t)}if(document.querySelector("#next-add-form")){let t=document.createElement("div");document.querySelector("#next-add-form").appendChild(t),y({render:()=>C(gn,{challenge_id:window.CHALLENGE_ID})}).mount(t)}if(document.querySelector("#comment-box")){let t=document.createElement("div");document.querySelector("#comment-box").appendChild(t),y({render:()=>C(K,{challenge_id:window.CHALLENGE_ID})}).mount(t)}c.get(o.config.urlRoot+"/api/v1/challenges/types",function(t){const e=t.data;A(e.standard),c("#create-chals-select input[name=type]").change(function(){let l=e[this.value];A(l)})})});
